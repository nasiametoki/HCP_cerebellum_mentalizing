#!/bin/sh
#PBS -N tract_CTC_Lcerebel2Rbrain_100206-171633
#PBS -q normal
#PBS -l nodes=12:ppn=28
#PBS -l walltime=48:00:00
#PBS -v subjects="100206 100307 100408 100610 101006 101309 101410 102311 102513 102816 103111 103414 103515 103818 104012 104416 104820 105014 105115 105216 105620 105923 106016 106319 106521 107018 107321 107422 108121 108222 108323 108525 108828 109123 109830 110411 110613 111009 111312 111413 111514 111716 112112 112314 112516 112920 113215 113619 113922 114217 114419 114621 114823 115017 115320 115825 116221 116524 116726 117122 117324 117930 118124 118225 118528 118730 118932 119126 119732 119833 120212 120515 120717 121416 121618 121921 122317 122620 122822 123117 123521 123925 124220 124422 124624 124826 126325 126628 127630 127933 128026 128632 128935 129028 129129 129331 129634 129937 130316 130417 130619 130821 131217 131419 131722 131823 131924 132017 133019 133625 133827 133928 134021 134223 134425 134728 134829 135225 135730 135932 136732 136833 137229 137633 138231 138837 139233 139637 139839 140117 140319 140824 141119 141422 141826 143325 144125 144428 144731 144832 145127 145834 146129 146331 146432 146533 146937 147030 148032 148133 148335 148840 148941 149236 149337 149539 149741 149842 150625 150726 151223 151425 151526 151728 151829 152831 153025 153227 153429 154229 154431 154532 154734 154936 155231 155635 155938 156031 156233 156334 156435 156536 156637 157336 157437 157942 158035 158136 158338 158540 158843 159138 159239 159441 159744 159946 160123 160830 160931 161327 161630 161731 162026 162228 162733 162935 163129 163331 163836 164030 164131 164939 165638 166438 167036 167238 168139 168240 168745 169444 169747 170631 171330 171532 171633"
#PBS

cd $PBS_O_WORKDIR

module load fsl/5.0.10-gpu
fslinit

rm -f cmd_${PBS_JOBID}.txt
touch cmd_${PBS_JOBID}.txt

for m in L_1 L_2 L_3 L_4 L_5a L_5 L_6a L_6 L_7a L_7 L_8
do
for s in R_ATL R_DMPFC R_PreC R_TPJ R_VMPFC
do
  mkdir -p ${PWD}/tract_CTC_Lcerebel2Rbrain/${m}_${s}
for n in ${subjects}
  do
echo probtrackx2 -x /path/SOCIAL/${m}.nii -l --modeuler --onewaycondition --wayorder -c 0.2 -S 2000 --steplength=0.5 -P 5000 --fibthresh=0.01 --distthresh=0.0 --sampvox=0.0 --xfm=/data/projects/fmri/${n}/MNINonLinear/xfms/standard2acpc_dc.nii.gz --invxfm=/data/projects/fmri/${n}/MNINonLinear/xfms/acpc_dc2standard.nii.gz --avoid=/path/waypoints/avoid_4_CTC_Lcerebel2Rbrain.txt --forcedir --opd -s /gpfs/projects/fmri/bedpostX_gpu_g_rician/${n}.bedpostX/merged -m /gpfs/projects/fmri/bedpostX_gpu_g_rician/${n}.bedpostX/nodif_brain_mask --dir=/path/tract_CTC_Lcerebel2Rbrain/${m}_${s}/${n} --waypoints=/path/waypoints/waypoints_4_CTC_Lcerebel2Rbrain/waypoints_${n}_${s}.txt --waycond=AND >> cmd_${PBS_JOBID}.txt

done
done
done

torque-launch -p chkpt_${PBS_JOBID}.txt cmd_${PBS_JOBID}.txt